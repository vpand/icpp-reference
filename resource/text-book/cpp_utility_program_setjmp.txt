setjmp

   From cppreference.com
   < cpp | utility | program

   C++
   Compiler support
   Freestanding and hosted
   Language
   Standard library
   Standard library headers
   Named requirements
   Feature test macros (C++20)
   Language support library
   Concepts library (C++20)
   Metaprogramming library (C++11)
   Diagnostics library
   General utilities library
   Strings library
   Containers library
   Iterators library
   Ranges library (C++20)
   Algorithms library
   Numerics library
   Localizations library
   Input/output library
   Filesystem library (C++17)
   Regular expressions library (C++11)
   Concurrency support library (C++11)
   Technical specifications
   Symbols index
   External libraries

   Utilities library
   Language support
   Type support (basic types, RTTI)
   Library feature-test macros (C++20)
   Dynamic memory management
   Program utilities
   Coroutine support (C++20)
   Variadic functions
   is_constant_evaluated
   (C++20)
   is_within_lifetime
   (C++26)
   initializer_list
   (C++11)
   source_location
   (C++20)
   Debugging support
   is_debugger_present
   (C++26)
   breakpoint_if_debugging
   (C++26)
   breakpoint
   (C++26)
   Three-way comparison
   three_way_comparablethree_way_comparable_with
   (C++20)(C++20)
   strong_ordering
   (C++20)
   weak_ordering
   (C++20)
   partial_ordering
   (C++20)
   common_comparison_category
   (C++20)
   compare_three_way_result
   (C++20)
   compare_three_way
   (C++20)
   strong_order
   (C++20)
   weak_order
   (C++20)
   partial_order
   (C++20)
   compare_strong_order_fallback
   (C++20)
   compare_weak_order_fallback
   (C++20)
   compare_partial_order_fallback
   (C++20)
   is_eqis_ltis_lteq
   (C++20)(C++20)(C++20)
   is_neqis_gtis_gteq
   (C++20)(C++20)(C++20)
   General utilities
   Date and time
   Function objects
   Formatting library (C++20)
   bitset
   hash
   (C++11)
   Relational operators (deprecated in C++20)
   rel_ops::operator!=rel_ops::operator>

   rel_ops::operator<=rel_ops::operator>=
   Integer comparison functions
   cmp_equalcmp_lesscmp_less_than
   (C++20)(C++20)(C++20)
   cmp_not_equalcmp_greatercmp_greater_than
   (C++20)(C++20)(C++20)
   in_range
   (C++20)
   Swap and type operations
   swap
   ranges::swap
   (C++20)
   exchange
   (C++14)
   declval
   (C++11)
   to_underlying
   (C++23)
   forward
   (C++11)
   forward_like
   (C++23)
   move
   (C++11)
   move_if_noexcept
   (C++11)
   as_const
   (C++17)
   Common vocabulary types
   pair
   tuple
   (C++11)
   optional
   (C++17)
   any
   (C++17)
   variant
   (C++17)
   tuple_size
   (C++11)
   tuple_element
   (C++11)
   apply
   (C++17)
   make_from_tuple
   (C++17)
   expected
   (C++23)
   Elementary string conversions
   to_chars
   (C++17)
   from_chars
   (C++17)
   chars_format
   (C++17)
   to_chars_result
   (C++17)
   from_chars_result
   (C++17)

   Program support utilities
   Program termination
   abort
   exit
   quick_exit
   (C++11)
   _Exit
   (C++11)
   atexit
   at_quick_exit
   (C++11)
   EXIT_SUCCESSEXIT_FAILURE
   Unreachable control flow
   unreachable
   (C++23)
   Communicating with the environment
   system
   getenv
   Signals
   signal
   raise
   sig_atomic_t
   SIG_DFLSIG_IGN
   SIG_ERR
   Signal types
   SIGABRTSIGFPESIGILL
   SIGINTSIGSEGVSIGTERM
   Non-local jumps
   setjmp
   longjmp
   Types
   jmp_buf

   Defined in header <csetjmp>
   #define setjmp(env) /* implementation-defined */

   Saves the current execution context into a variable env of type
   std::jmp_buf. This variable can later be used to restore the current
   execution context by std::longjmp function. That is, when a call to
   std::longjmp function is made, the execution continues at the
   particular call site that constructed the std::jmp_buf variable passed
   to std::longjmp. In that case setjmp returns the value passed to
   std::longjmp.

   The invocation of setjmp must appear only in one of the following
   contexts:
    1. the entire controlling expression of if, switch, while, do-while,
       for.
switch (setjmp(env)) { // ...
    2. one operand of a relational or equality operator with the other
       operand an integer constant expression, with the resulting
       expression being the entire controlling expression of if, switch,
       while, do-while, for.
if (setjmp(env) > 0) { // ...
    3. the operand of a unary ! operator with the resulting expression
       being the entire controlling expression of if, switch, while,
       do-while, for.
while (!setjmp(env)) { // ...
    4. the entire expression of an expression statement (possibly cast to
       void).
setjmp(env);

   If setjmp appears in any other context, the behavior is undefined.

   Additionally, the behavior is undefined if setjmp is invoked in a
   coroutine in a place where the co_await operator may be used.
   (since C++20)

   Upon return to the scope of setjmp:
     * all accessible objects, floating-point status flags, and other
       components of the abstract machine have the same values as they had
       when std::longjmp was executed,
     * except for the non-volatile local variables in the function
       containing the invocation of setjmp, whose values are indeterminate
       if they have been changed since the setjmp invocation.

Parameters

   env - variable to save the execution state of the program to

Return value

   0 if the macro was called by the original code and the execution
   context was saved to env.

   Non-zero value if a non-local jump was just performed. The return value
   is the same as passed to std::longjmp.

Notes

   Above requirements forbid using return value of setjmp in data flow
   (e.g. to initialize or assign an object with it). The return value can
   only be either used in control flow or discarded.

Example

   Run this code
#include <array>
#include <cmath>
#include <csetjmp>
#include <cstdlib>
#include <format>
#include <iostream>

std::jmp_buf solver_error_handler;

std::array<double, 2> solve_quadratic_equation(double a, double b, double c)
{
    const double discriminant = b * b - 4.0 * a * c;
    if (discriminant < 0)
        std::longjmp(solver_error_handler, true); // Go to error handler

    const double delta = std::sqrt(discriminant) / (2.0 * a);
    const double argmin = -b / (2.0 * a);
    return {argmin - delta, argmin + delta};
}

void show_quadratic_equation_solution(double a, double b, double c)
{
    std::cout << std::format("Solving {}x + {}x + {} = 0...\n", a, b, c);
    auto [x_0, x_1] = solve_quadratic_equation(a, b, c);
    std::cout << std::format("x_1 = {}, x_2 = {}\n\n", x_0, x_1);
}

int main()
{
    if (setjmp(solver_error_handler))
    {
        // Error handler for solver
        std::cout << "No real solution\n";
        return EXIT_FAILURE;
    }

    for (auto [a, b, c] : {std::array{1, -3, 2}, {2, -3, -2}, {1, 2, 3}})
        show_quadratic_equation_solution(a, b, c);

    return EXIT_SUCCESS;
}

   Output:
Solving 1x + -3x + 2 = 0...
x_1 = 1, x_2 = 2

Solving 2x + -3x + -2 = 0...
x_1 = -0.5, x_2 = 2

Solving 1x + 2x + 3 = 0...
No real solution

See also

   longjmp
   jumps to specified location
   (function)
   Retrieved from
   "https://en.cppreference.com/mwiki/index.php?title=cpp/utility/program/
   setjmp&oldid=148740"

Navigation

     * Online version
     * Offline version retrieved 2024-06-10 08:17.

     * This page was last modified on 2 March 2023, at 20:44.
     * This page has been accessed 109,520 times.
